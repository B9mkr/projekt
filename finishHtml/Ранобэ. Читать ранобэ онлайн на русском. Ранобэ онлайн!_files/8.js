webpackJsonp([8],{"1klX":function(t,e,s){var n=s("VU/8")(s("FHdR"),s("J9xb"),!1,null,null,null);t.exports=n.exports},"3wP3":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={inject:["store"],props:{item:{type:Object,default:function(){return{}}}},methods:{remove:function(){confirm("Удалить сообщение?")&&this.$emit("remove",this.item.id)}}}},"6Ikj":function(t,e,s){var n=s("VU/8")(s("ZlUE"),s("UuLt"),!1,null,null,null);t.exports=n.exports},BXEb:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,i,a=s("I3G/"),r=s.n(a),o=s("u5FJ"),c=s("Jaym"),l=s("fSCB"),u=s.n(l),h=s("kK0S"),d=s.n(h),m=s("1UPi"),p=Object(m.c)("settings"),f=o.g.has(document.body,"page_mobile");(p.allPage&&p.inWindow&&!f||Object(o.l)("#chat"))&&(n=document.createElement("div"),i=new r.a({el:n,data:{store:{items:[],auth:!1,isMobile:f,text:""},settings:p},provide:function(){return{store:this.store,settings:this.settings}},watch:{settings:{deep:!0,handler:function(){c.w.update("chat",{settings:this.settings})}},"settings.inWindow":function(){this._windowToggled=!0,this.appendInstance()}},mounted:function(){this.appendInstance()},methods:{appendInstance:function(){var t=this.settings.inWindow&&!f?document.body:Object(o.l)("#chat");if(null===t){var e=this.$el.parentNode;this.$destroy(),e.removeChild(this.$el)}else t.appendChild(this.$el)}},render:function(t){return this.settings.inWindow&&!f?t(u.a,{props:{open:this._windowToggled}}):t(d.a)}}),window._CHAT_INSTANCE=i)},FHdR:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=s("u5FJ"),i=s("6Vnj"),a=s.n(i);e.default={components:{VCheckbox:a.a},props:{show:Boolean},inject:["settings"],watch:{show:function(t){this._handler=t,t?Object(n.c)(document,"click",this.toggleMenu):Object(n.b)(document,"click",this.toggleMenu)}},beforeDestroy:function(){this._handler&&Object(n.b)(document,"click",this.toggleMenu)},methods:{toggleMenu:function(t){var e=t.target,s=this.$refs.menu;e===s||s.contains(e)||this.$emit("update:show",!this.show)}}}},J9xb:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{directives:[{name:"show",rawName:"v-show",value:t.show,expression:"show"}],ref:"menu",staticClass:"chat-wrap__settings menu menu_small"},[s("v-checkbox",{staticClass:"menu__item",model:{value:t.settings.inWindow,callback:function(e){t.$set(t.settings,"inWindow",e)},expression:"settings.inWindow"}},[t._v("\n    В окне\n  ")]),t._v(" "),s("v-checkbox",{staticClass:"menu__item",model:{value:t.settings.allPage,callback:function(e){t.$set(t.settings,"allPage",e)},expression:"settings.allPage"}},[t._v("\n    На всех страницах\n  ")]),t._v(" "),s("v-checkbox",{staticClass:"menu__item",model:{value:t.settings.alwaysOpen,callback:function(e){t.$set(t.settings,"alwaysOpen",e)},expression:"settings.alwaysOpen"}},[t._v("\n    Автоматически открывать\n  ")])],1)},staticRenderFns:[]}},"Pam+":function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"aside__panel paper"},[s("h3",{staticClass:"aside__title"},[s("span",{staticClass:"aside__title-inner chat__title"},[s("span",[t._v("Мини чат")]),t._v(" "),s("div",[t._m(0),t._v(" "),t.store.isMobile?t._e():s("span",{staticClass:"tooltip",attrs:{"data-place":"left","aria-label":"Чат в окне"},on:{click:t.toggleWindow}},[s("i",{staticClass:"fa fa-window-maximize"})])])])]),t._v(" "),s("chat")],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("a",{staticClass:"chat__rules link-default tooltip",attrs:{href:"/news/rules_chat","data-place":"left","aria-label":"Правила чата"}},[e("i",{staticClass:"fa fa-exclamation-triangle"})])}]}},RnaK:function(t,e,s){var n=s("VU/8")(s("3wP3"),s("iRQX"),!1,null,null,null);t.exports=n.exports},"U/9O":function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{ref:"wrap",staticClass:"chat-wrap",class:{"is-open":t.isOpen,"is-unpinned":t.settings.unpinned},style:t.styles},[s("div",{staticClass:"chat-wrap__head",on:{click:function(e){return t.toggleOpen(!0)}}},[s("div",{staticClass:"chat-wrap__resizer",on:{mousedown:t.resizeStart}},[s("svg",{attrs:{viewBox:"0 0 10 10"}},[s("path",{attrs:{d:"M0 0h2v2h-2v-2z"}}),t._v(" "),s("path",{attrs:{d:"M0 3h2v2h-2v-2z"}}),t._v(" "),s("path",{attrs:{d:"M0 6h2v2h-2v-2z"}}),t._v(" "),s("path",{attrs:{d:"M3 0h2v2h-2v-2z"}}),t._v(" "),s("path",{attrs:{d:"M3 3h2v2h-2v-2z"}}),t._v(" "),s("path",{attrs:{d:"M6 0h2v2h-2v-2z"}})])]),t._v(" "),s("div",{staticClass:"chat-wrap__title",on:{mousedown:t.moveStart}},[s("span",[t._v("Мини чат")]),t._v(" "),s("i",{staticClass:"fa fa-fw fa-comments-o"})]),t._v(" "),s("div",{staticClass:"chat-wrap__actions"},[t._m(0),t._v(" "),s("div",{staticClass:"chat-wrap__action tooltip",attrs:{"aria-label":t.settings.unpinned?"Закрепить":"Открепить","data-place":"left"},on:{click:t.togglePin}},[s("i",{staticClass:"chat-wrap__pin fa fa-fw fa-thumb-tack"})]),t._v(" "),s("div",{staticClass:"chat-wrap__action"},[s("div",{on:{click:function(e){e.stopPropagation(),t.showSettings=!t.showSettings}}},[s("i",{staticClass:"fa fa-fw fa-cog"})]),t._v(" "),s("chat-settings",{attrs:{show:t.showSettings},on:{"update:show":function(e){t.showSettings=e}}})],1),t._v(" "),s("div",{staticClass:"chat-wrap__action tooltip",attrs:{"data-place":"left","aria-label":"Свернуть"},on:{click:function(e){return e.stopPropagation(),t.toggleOpen(!1)}}},[s("i",{staticClass:"fa fa-fw fa-close"})])])]),t._v(" "),s("chat",{directives:[{name:"show",rawName:"v-show",value:t.isOpen,expression:"isOpen"}],attrs:{"chat-size":t.size.h}})],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("a",{staticClass:"chat-wrap__action chat__rules tooltip",attrs:{href:"/news/rules_chat","data-place":"left","aria-label":"Правила чата"}},[e("i",{staticClass:"fa fa-exclamation-triangle"})])}]}},UuLt:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"chat"},[s("div",{staticClass:"chat__items",style:t.size,on:{click:t.addReply}},[t.store.items.length?[t._l(t.store.items,function(e){return s("chat-item",{key:e.id,attrs:{item:e},on:{remove:t.remove}})}),t._v(" "),s("div",{staticClass:"chat__more button button_block",class:{"button_loading-inv":t.loading},on:{click:t.loadMore}},[t._v("\n        Загрузить еще\n      ")])]:t._l(5,function(e){return s("div",{key:e,staticClass:"placeholder placeholder_static"},[s("div",{staticClass:"placeholder-masker placeholder__chat-avatar"}),t._v(" "),s("div",{staticClass:"placeholder-masker placeholder__chat-username"}),t._v(" "),s("div",{staticClass:"placeholder-masker placeholder__chat-date"}),t._v(" "),s("div",{staticClass:"placeholder-masker placeholder__chat-text-first"}),t._v(" "),s("div",{staticClass:"placeholder-masker placeholder__chat-text-second"})])})],2),t._v(" "),s("div",{ref:"sendForm",staticClass:"chat-send"},[s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.store.text,expression:"store.text"}],ref:"area",staticClass:"chat-send__area",attrs:{maxlength:"300",placeholder:"Ваше сообщение"},domProps:{value:t.store.text},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:e.ctrlKey?t.sendMessage(e):null},blur:function(e){return t.updateAreaSize({trim:!0})},input:function(e){e.target.composing||t.$set(t.store,"text",e.target.value)}}}),t._v(" "),s("button",{staticClass:"chat-send__button",class:t.sendButtonClasses,attrs:{disabled:t.sending||!t.textLength,"data-place":"top-end","aria-label":"Ctrl + Enter - Отправить"},on:{click:t.sendMessage}},[s("i",{staticClass:"fa fa-paper-plane-o"})])])])},staticRenderFns:[]}},ZlUE:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=s("mtWM"),i=s.n(n),a=s("RnaK"),r=s.n(a),o=s("Ngrm"),c=s("u5FJ"),l=s("1UPi"),u=s("IDmg"),h=s("Mqyi"),d=s("Jaym");function m(t){for(var e=1;e<arguments.length;e++)if(e%2){var s=null!=arguments[e]?arguments[e]:{},n=Object.keys(s);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(s).filter(function(t){return Object.getOwnPropertyDescriptor(s,t).enumerable}))),n.forEach(function(e){p(t,e,s[e])})}else Object.defineProperties(t,Object.getOwnPropertyDescriptors(arguments[e]));return t}function p(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}var f={a11y:!1,animation:"fade",animateFill:!1,placement:"top-start",distance:5,theme:"message-preview"},v={avatar:"avatar",name:"username",content:"content",className:""},_=function(t,e){return Object(h.a)("div",{className:"message-preview ".concat(e.className)},t[e.avatar]&&Object(h.a)("img",{src:t[e.avatar],alt:t[e.name],className:"message-preview__avatar"}),t[e.name]&&Object(h.a)("span",{className:"message-preview__username"},t[e.name]),Object(h.a)("div",{className:"message-preview__content",dangerouslySetInnerHTML:t[e.content]}))},g=s("JnrT"),b=s.n(g);function w(t){return function(t){if(Array.isArray(t)){for(var e=0,s=new Array(t.length);e<t.length;e++)s[e]=t[e];return s}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var O,x,C,j=function(t){return t[0]},y=function(){clearInterval(O),O=null};e.default={componentName:"Chat",components:{ChatItem:r.a},inject:["store"],props:{chatSize:Number},data:function(){return{loading:!1,sending:!1,areaHeight:40}},computed:{textLength:function(){return this.store.text.trim().length},sendButtonClasses:function(){return{"button_loading-inv":this.sending,tooltip_delay:!this.sending,tooltip:!this.sending&&this.textLength}},size:function(){if(null!=this.chatSize)return{height:"".concat(this.chatSize-this.areaHeight-30,"px")}}},created:function(){var t=this;Object(l.b)(function(e,s){e||(t.store.items=s.items,t.store.auth=s.auth,t.messagesInterval())},{auth:!0}),x=setInterval(function(){return t.checkOnilneUsers()},1e6)},mounted:function(){var t,e,s,n=this,a=this.$refs.area;this.store.isMobile&&this.$refs.sendForm&&document.body.appendChild(this.$refs.sendForm),a&&(b()(a),Object(c.c)(a,"autosize:resized",function(){n.areaHeight=a.offsetHeight})),t={url:"/chat/message",el:this.$el,tippy:{target:"span[title]"},propNames:{content:"text",name:"name",className:"message-preview_chat"},render:function(t,e){var s=Object(d.d)(n.store.items,function(e){return e.id===t});return null===s?null:_(s,e)}},e=m({},v,{},t.propNames),(s=m({},f,{},t.tippy)).wait||(s.wait=function(s){var n=c.f.has(s.reference,"data-init"),a=Object(c.f)(s.reference,"title"),r=!1;if(n)return s.show();if(c.f.remove(s.reference,"title"),t.render&&Object(d.m)(t.render)){var o=t.render(parseInt(a,10),e);null!==o&&(r=!0,s.setContent(o),Object(c.f)(s.reference,"data-init",!0))}r||(s.setContent(Object(h.a)("div",{className:"message-preview ".concat(e.className)},Object(h.a)("div",{className:"loader-circle loader-circle_small"}))),i.a.get(t.url,{params:{id:a}}).then(function(t){var n=t.data;s.setContent(_(n,e)),Object(c.f)(s.reference,"data-init",!0)})),s.show()}),Object(u.default)(t.el,s)},methods:{remove:function(t){var e=this,s=w(this.store.items),n=Object(d.e)(this.store.items,function(e){return e.id===t});this.store.items.splice(n,1),i.a.delete("/chat/".concat(t)).catch(function(){e.store.items=s})},messagesInterval:function(){var t=this;O&&y(),O=setInterval(function(){return t.checkMessages()},2e4)},checkMessages:function(){var t=this;Object(l.b)(function(e,s){if(e)return y();s.length&&(t.store.items=s.concat(t.store.items))},{before:j(this.store.items).id})},checkOnilneUsers:function(){var t=this,e=this.store.items.map(function(t){return t.user_id}).filter(function(t,e,s){return s.indexOf(t)===e});i.a.post("/chat/check-online",{users:e}).then(function(e){for(var s=e.data,n=t.store.items.length;n--;){var i=t.store.items[n];s[i.user_id]&&(i.online=s[i.user_id])}}).catch(function(){return clearInterval(x)})},loadMore:function(){var t,e=this;this.loading||(this.loading=!0,Object(l.b)(function(t,s){if(e.loading=!1,t)return o.a.alert("Произошла ошибка при загрузке");e.store.items=e.store.items.concat(s)},{after:(t=this.store.items,t[t.length-1]).id}))},addReply:function(t){var e=t.target;if(this.store.auth){var s=e.closest(".chat-item__reply");s&&(this.store.text="".concat(this.trimText()," ").concat(Object(c.f)(s,"data-reply")," "),this.updateAreaSize({focus:!0}))}},sendMessage:function(){var t=this;if(!this.store.auth)return o.a.alert("Вы не авторизованы");!this.sending&&this.textLength&&(C&&C===this.trimText()||(this.sending=!0,this.store.text=C=this.trimText(),y(),i.a.post("/chat",{text:C,before:j(this.store.items).id}).then(function(t){return t.data}).then(function(e){t.store.text="",t.sending=!1,t.store.items=e.concat(t.store.items),t.messagesInterval(),t.updateAreaSize()}).catch(function(){return t.sending=!1})))},updateAreaSize:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=e.focus;e.trim&&(this.store.text=this.trimText()),this.$nextTick(function(){b.a.update(t.$refs.area),s&&t.$refs.area.focus()})},trimText:function(){return this.store.text.trim()}}}},fSCB:function(t,e,s){var n=s("VU/8")(s("hqZ6"),s("U/9O"),!1,null,null,null);t.exports=n.exports},hqZ6:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=s("6Ikj"),i=s.n(n),a=s("1klX"),r=s.n(a),o=s("Jaym"),c=s("u5FJ"),l=s("1UPi"),u=350,h=285,d={HEIGHT:0,WIDTH:0},m={size:Object(l.c)("size"),start:{x:0,y:0}},p={data:function(){return{size:Object(l.c)("size")}},methods:{resizeStart:function(t){var e=this.getWrapRect(),s=e.top,n=e.left,i=m.start,a=m.size;i.x=t.clientX,i.y=t.clientY,d.HEIGHT=s+a.h,d.WIDTH=n+a.w,Object(c.c)(document,"mouseup",this.resizeEnd),Object(c.c)(document,"mousemove",this.resizeMove)},resizeMove:function(t){var e=m.start.x-t.clientX+m.size.w,s=m.start.y-t.clientY+m.size.h;this.size.w=Object(l.a)(e,h,d.WIDTH),this.size.h=Object(l.a)(s,u,d.HEIGHT)},resizeEnd:function(){m.size.w=this.size.w,m.size.h=this.size.h,o.w.update("chat",{size:m.size}),Object(c.b)(document,"mouseup",this.resizeEnd),Object(c.b)(document,"mousemove",this.resizeMove)}}},f={top:0,left:0,right:0,bottom:0},v={x:0,y:0},_={h:0,w:0},g={data:function(){return{pos:Object(l.c)("pos")}},watch:{"settings.unpinned":{immediate:!0,handler:function(t){t?this.setWindowSize():(this.pos=Object(l.d)("pos"),o.w.update("chat",{pos:this.pos}))}}},mounted:function(){Object(c.c)(window,"resize",this.onWindowResize)},beforeDestroy:function(){Object(c.b)(window,"resize",this.onWindowResize)},methods:{moveStart:function(t){if(this.isOpen&&this.settings.unpinned){var e=this.getWrapRect(),s=e.top,n=e.left;v.x=this.size.w-(t.clientX-n),v.y=this.size.h-(t.clientY-s),this.setWindowBorders(),Object(c.c)(document,"mousemove",this.moveHandler),Object(c.c)(document,"mouseup",this.moveEnd)}},moveHandler:function(t){var e=_.w-v.x-t.clientX,s=_.h-v.y-t.clientY;this.pos.bottom=Object(l.a)(s,f.bottom,f.top),this.pos.right=Object(l.a)(e,f.right,f.left)},moveEnd:function(){o.w.update("chat",{pos:this.pos}),Object(c.b)(document,"mousemove",this.moveHandler),Object(c.b)(document,"mouseup",this.moveEnd)},setWindowBorders:function(){f.top=_.h-this.size.h,f.left=_.w-this.size.w},setWindowSize:function(){var t=document.documentElement;_.w=t.clientWidth,_.h=t.clientHeight},onWindowResize:function(){this.setWindowSize(),this.setWindowBorders()}}};e.default={components:{Chat:i.a,ChatSettings:r.a},mixins:[p,g],inject:["settings"],props:{open:{type:Boolean,default:!1}},data:function(){return{isOpen:this.open||this.settings.alwaysOpen,showSettings:!1}},computed:{styles:function(){return this.isOpen?{width:"".concat(this.size.w,"px"),height:"".concat(this.size.h,"px"),right:"".concat(this.pos.right,"px"),bottom:"".concat(this.pos.bottom,"px")}:null}},methods:{toggleOpen:function(t){t&&this.isOpen||(this.isOpen=t,this.showSettings=!1)},togglePin:function(){this.settings.unpinned=!this.settings.unpinned},getWrapRect:function(){return this.$refs.wrap.getBoundingClientRect()}}}},iRQX:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"chat-item"},[s("div",{staticClass:"chat-item__header"},[s("div",{staticClass:"chat-item__ava-wrap"},[s("img",{staticClass:"chat-item__avatar",attrs:{src:t.item.avatar}}),t._v(" "),s("div",{staticClass:"chat-item__status",attrs:{"data-status":t.item.online}})]),t._v(" "),s("div",{staticClass:"chat-item__header-content"},[s("a",{staticClass:"chat-item__username text-truncate",attrs:{href:"/user/"+t.item.user_id}},[t._v(t._s(t.item.name))]),t._v(" "),s("div",{staticClass:"chat-item__date"},[s("timeago",{attrs:{datetime:t.item.created_at,"auto-update":60}})],1)])]),t._v(" "),s("div",{staticClass:"chat-item__message",domProps:{innerHTML:t._s(t.item.text)}}),t._v(" "),s("button",{staticClass:"chat-item__reply",attrs:{"data-reply":"@"+t.item.name+"#"+t.item.id}},[t._v("\n    Ответить\n  ")]),t._v(" "),t.store.auth&&t.store.auth.access?s("button",{staticClass:"chat-item__remove",on:{click:t.remove}},[t._v("\n    Удалить\n  ")]):t._e()])},staticRenderFns:[]}},kK0S:function(t,e,s){var n=s("VU/8")(s("kiZs"),s("Pam+"),!1,null,null,null);t.exports=n.exports},kiZs:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=s("6Ikj"),i=s.n(n);e.default={components:{Chat:i.a},inject:["settings","store"],methods:{toggleWindow:function(){this.settings.inWindow=!0}}}}});